{"author":{"id":"a46dbc32f4bff58987bcbb31d1c10d2c11ce5c6c6ef1de92b086459ddff5747e"},"ops":[{"type":1,"timestamp":1685541954,"nonce":"AC4geKAPoENrw2MTXEqE89/SHFE=","metadata":{"github-id":"I_kwDOJlAk-M5nX4q9","github-url":"https://github.com/zhukovgreen/pytest-when/issues/5","origin":"github"},"title":"Not specified parameter kwargs where non used failing","message":"I have a code where boto3 library is creating client, which I would like to mock for further usage.\n\nFollowing code is heavily redacted for bare minimum.\n\nPython version: 3.8.16\npytest-when version: 1.0.6\npytest version: 7.3.1\n \nThe method looks like:\n```python\nimport boto3\ndef create_client():\n    return boto3.client(\"stepfunctions\")\n```\n\nIn a test, I would like to check if boto3 has been called with correct parameter, so I created simple tests but they are all failing.\n```python\nimport boto3\nfrom unittest.mock import MagicMock\nfrom redacted_package import create_step_function_client\n\ndef test_create_client(when):\n    my_mock = MagicMock()\n    when(boto3, \"client\").called_with(\"stepfunctions\").then_return(my_mock)\n    assert create_step_function_client() is my_mock\n\n## Got ValueError: Not specified parameter kwargs. Incompatible call specification args=('stepfunctions',), kwargs={} to the function with signature (*args, **kwargs)\n\ndef test_create_client_2(when):\n    my_mock = MagicMock()\n    when(boto3, \"client\").called_with(\"stepfunctions\", kwargs={}).then_return(my_mock)\n    assert create_step_function_client() is my_mock\n\n## Got TypeError: unhashable type: 'dict'\n\ndef test_create_client_3(when):\n    my_mock = MagicMock()\n    when(boto3, \"client\").called_with(\"stepfunctions\", kwargs=None).then_return(my_mock)\n    assert create_step_function_client() is my_mock\n\n## Got ValueError: Not specified parameter kwargs. Incompatible call specification args=('stepfunctions',), kwargs={} to the function with signature (*args, **kwargs)\n\ndef test_create_client_4(when):\n    my_mock = MagicMock()\n    when(boto3, \"client\").called_with(\"stepfunctions\", kwarg_1=\"None\").then_return(my_mock)\n    assert create_step_function_client() is my_mock\n\n## Got ValueError: Not specified parameter kwargs. Incompatible call specification args=('stepfunctions',), kwargs={'kwarg_1': 'None'} to the function with signature (*args, **kwargs)\n\ndef test_create_client_5(when):\n    my_mock = MagicMock()\n    when(boto3, \"client\").called_with(\"stepfunctions\", when.markers.any).then_return(my_mock)\n    assert create_step_function_client() is my_mock\n\ndef test_create_client_6(when):\n    my_mock = MagicMock()\n    when(boto3, \"client\").called_with(\"stepfunctions\", kwargs=when.markers.any).then_return(my_mock)\n    assert create_step_function_client() is my_mock\n\n## Got ValueError: Not specified parameter kwargs. Incompatible call specification args=('stepfunctions',), kwargs={} to the function with signature (*args, **kwargs)\n\ndef test_create_client_7(when):\n    my_mock = MagicMock()\n    when(boto3, \"client\").called_with(\"stepfunctions\", kwarg_1=when.markers.any).then_return(my_mock)\n    assert create_step_function_client() is my_mock\n## Got ValueError: Not specified parameter kwargs. Incompatible call specification args=('stepfunctions',), kwargs={'kwarg_1': \u003cMarkers.any: 'any'\u003e} to the function with signature (*args, **kwargs)\n```","files":null}]}